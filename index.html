
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>Jackie&#39;s Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Jackie wu">
    

    
    <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Jackie's Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Jackie's Blog">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Jackie's Blog">
<meta name="twitter:description">

    
    <link rel="alternative" href="/atom.xml" title="Jackie&#39;s Blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="Jackie&#39;s Blog" title="Jackie&#39;s Blog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Jackie&#39;s Blog">Jackie&#39;s Blog</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">主页</a></li>
					
						<li><a href="/archives">归档</a></li>
					
						<li><a href="/about">关于</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/10/04/elasticsearch/" title="elasticsearch学习" itemprop="url">elasticsearch学习</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Jackie wu" target="_blank" itemprop="author">Jackie wu</a>
		
  <p class="article-time">
    <time datetime="2015-10-04T02:32:35.000Z" itemprop="datePublished"> 发表于 2015-10-04</time>
    
  </p>
</header>
    <div class="article-content">
        
        <pre><code>在使用了Mongodb之后发现，Mongodb差强人意的查询，还有令人发指的<span class="keyword">Skip</span>在面对大数据，查询时候的查询速度地下的问题，将方向投向了ElasticSearch搜索引擎上，ElasticSearch虽然说在数据的导入和建立索引的过程十分缓慢，但是查询速度相比Mongodb确实有<span class="number">10</span>倍的提交。    
</code></pre><p>简单记录下搭建和学习的一些内容： </p>
<ol>
<li>ElasticSearch环境搭建这个不再赘述了，官方的安装十分的方便</li>
<li>ElasticSearch环境访问 <a href="http://localhost:9200/" target="_blank" rel="external">http://localhost:9200/</a>    就能访问看到</li>
<li><p>建立索引可以导入数据一条一条的建立，索引页可以直接全部load数据建立索引<br>代码： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">i = <span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> i&lt; <span class="number">100000000</span>:</span><br><span class="line">     user = &#123;&#125; </span><br><span class="line">     user[<span class="string">'name'</span>] = <span class="string">'test'</span>+str(random.randint(<span class="number">0</span>, i))</span><br><span class="line">     user[<span class="string">'text'</span>] = <span class="string">'daffadsfadsfa da jia hao '</span> + <span class="string">'test'</span>+str(random.randint(<span class="number">0</span>, i))+<span class="string">' This is a Text'</span></span><br><span class="line">     user[<span class="string">'created_at'</span>] = time.strftime(<span class="string">'%Y-%m-%d %H:%M:%S'</span>)</span><br><span class="line">  user[<span class="string">'id'</span>] = i</span><br><span class="line">     user[<span class="string">'random'</span>] = random.randint(<span class="number">0</span>,i) </span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">   es.index(index=<span class="string">'microblogs'</span>, doc_type=<span class="string">'tweets'</span>, body=user)</span><br></pre></td></tr></table></figure>
</li>
<li><p>Api使用</p>
<h5 id="查询名字为test100的记录">查询名字为test100的记录</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">result = es.search(index=<span class="string">'microblogs'</span>, body=&#123;</span><br><span class="line">          <span class="string">"query"</span>: &#123;<span class="string">"match"</span>: &#123;<span class="string">'name'</span>:<span class="string">'test100'</span>&#125;&#125; </span><br><span class="line">   &#125;, timeout=<span class="number">120</span>)</span><br></pre></td></tr></table></figure>
<h5 id="查询test10%的记录">查询test10%的记录</h5> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">result = es.search(index=<span class="string">'microblogs'</span>,  body=&#123;</span><br><span class="line"><span class="string">"query"</span>:&#123;<span class="string">"fuzzy_like_this_field"</span> : &#123; <span class="string">"name"</span> : &#123;<span class="string">"like_text"</span>: <span class="string">"test10"</span>, <span class="string">"max_query_terms"</span>:<span class="number">5</span>&#125;&#125;&#125;&#125;,  </span><br><span class="line">timeout=<span class="number">120</span>)</span><br><span class="line">``` </span><br><span class="line"><span class="comment">#####范围查询</span></span><br><span class="line">```python</span><br><span class="line"><span class="string">"query"</span> : &#123;</span><br><span class="line"><span class="string">"filtered"</span> : &#123;</span><br><span class="line">    <span class="string">"filter"</span> : &#123;</span><br><span class="line">	<span class="string">"range"</span> : &#123;</span><br><span class="line">	    <span class="string">"price"</span> : &#123;</span><br><span class="line">		<span class="string">"gte"</span> : <span class="number">20</span>,</span><br><span class="line">		<span class="string">"lt"</span>  : <span class="number">40</span></span><br><span class="line">	    &#125;</span><br><span class="line">	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="建立DateMapping">建立DateMapping</h5><p> ElasticSearch默认会把字符串当成String处理，类似’created_at’:’2015-08-16 20:00:’也会被当成字符串处理，所以不能使用时间的范围查询</p>
 <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">    curl -XPUT "http://10.141.201.96:9200/twitter" -d'</span><br><span class="line">&#123;</span><br><span class="line">   "mappings": &#123;</span><br><span class="line">      "tweet": &#123;</span><br><span class="line">            "date_detection": false, #不加上查询的时候还是会报错，ES默认会转换为local</span><br><span class="line">            "properties" : &#123;</span><br><span class="line">                "postDate" : &#123;</span><br><span class="line">                    "type" : "date",</span><br><span class="line">                    "format" : "YYYY-MM-dd HH:mm:ss"</span><br><span class="line">                &#125;,</span><br><span class="line">                "message":&#123;</span><br><span class="line">                "type":"string"</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;'</span><br></pre></td></tr></table></figure>
<h5 id="添加记录">添加记录</h5> <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">    curl -XPOST "http://10.141.201.96:9200/twitter/tweet/" -d'</span><br><span class="line">&#123;</span><br><span class="line">    "content": "Hello World!",</span><br><span class="line">    "postDate": "2015-09-16 15:00:00"</span><br><span class="line">&#125;'</span><br></pre></td></tr></table></figure>
<h5 id="日期范围查询：">日期范围查询：</h5> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">    result = es.search(index=<span class="string">'twitter'</span>,body= &#123;<span class="string">"query"</span>:&#123;</span><br><span class="line">    <span class="string">"range"</span>:&#123; </span><br><span class="line">        <span class="string">"postDate"</span>:&#123;</span><br><span class="line">                <span class="string">"gte"</span>:<span class="string">'2015-09-16 11:10:00'</span>,</span><br><span class="line">                <span class="string">"lte"</span>:<span class="string">'2015-09-16 15:01:00'</span></span><br><span class="line">        &#125;   </span><br><span class="line">        &#125;   </span><br><span class="line">    &#125;&#125;) </span><br><span class="line"><span class="keyword">print</span> result</span><br></pre></td></tr></table></figure>
<h5 id="查看索引建立信息">查看索引建立信息</h5> <figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/10.141.201.96:9200/twitter</span><span class="regexp">/tweet/</span><span class="constant">_mapping</span></span><br><span class="line">&#123;<span class="string">"twitter"</span><span class="symbol">:</span>&#123;<span class="string">"mappings"</span><span class="symbol">:</span>&#123;<span class="string">"tweet"</span><span class="symbol">:</span>&#123;<span class="string">"date_detection"</span><span class="symbol">:false</span>,<span class="string">"properties"</span><span class="symbol">:</span>&#123;<span class="string">"content"</span><span class="symbol">:</span>&#123;<span class="string">"type"</span><span class="symbol">:<span class="string">"string"</span></span>&#125;,<span class="string">"message"</span><span class="symbol">:</span>&#123;<span class="string">"type"</span><span class="symbol">:<span class="string">"string"</span></span>&#125;,<span class="string">"postDate"</span><span class="symbol">:</span>&#123;<span class="string">"type"</span><span class="symbol">:<span class="string">"date"</span></span>,<span class="string">"format"</span><span class="symbol">:<span class="string">"YYYY-MM-dd HH:mm:ss"</span></span>&#125;&#125;&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>
<h5 id="ElasticSearch_php组合复杂查询">ElasticSearch php组合复杂查询</h5> <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$params</span>[<span class="string">'body'</span>][<span class="string">'query'</span>][<span class="string">'bool'</span>][<span class="string">'must'</span>][]= <span class="keyword">array</span>(</span><br><span class="line">        <span class="string">'0'</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">        <span class="string">'range'</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">        <span class="string">'starttime'</span> =&gt; <span class="keyword">array</span>(<span class="string">'gte'</span> =&gt; <span class="variable">$start_begin</span>, <span class="string">'lte'</span> =&gt; <span class="variable">$start_end</span>)))<span class="comment">//匹配时间范围</span></span><br><span class="line">     );</span><br><span class="line"><span class="variable">$params</span>[<span class="string">'body'</span>][<span class="string">'query'</span>][<span class="string">'bool'</span>][<span class="string">'must'</span>][] = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">'multi_match'</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">'query'</span> =&gt; ’query text<span class="string">', </span><br><span class="line">    '</span>fields<span class="string">' =&gt; array('</span>fields1,<span class="string">'fields2'</span>),</span><br><span class="line">    <span class="string">'operator'</span> =&gt; <span class="string">'and'</span>)</span><br><span class="line">    );   <span class="comment">//查询匹配查询字符串的字段，某一个字段匹配就会查找出来</span></span><br><span class="line">    <span class="variable">$params</span>[<span class="string">'body'</span>][<span class="string">'query'</span>][<span class="string">'bool'</span>][<span class="string">'must'</span>][] = <span class="keyword">array</span>(<span class="string">'term'</span> =&gt; <span class="keyword">array</span>(<span class="string">'type'</span> =&gt; <span class="variable">$query</span>[<span class="string">'type'</span>])); <span class="comment">//查询type字段必须匹配内容</span></span><br></pre></td></tr></table></figure>
<h5 id="批量更新和删除操作使用ElasticSearch封装的bulk">批量更新和删除操作使用ElasticSearch封装的bulk</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line">* 批量更新</span><br><span class="line">*<span class="phpdoc"> @params</span> = array(</span><br><span class="line">*     '0'=&gt;array('id'=&gt;xxx,'filed_naem'=&gt;'type','value'=&gt;xxxx)</span><br><span class="line">*   );</span><br><span class="line">*/</span></span><br><span class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">updateDocs</span><span class="params">(<span class="variable">$params</span>)</span> </span>&#123;</span><br><span class="line">        <span class="variable">$data</span> = <span class="variable">$this</span>-&gt;data;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$params</span> <span class="keyword">as</span> <span class="variable">$k</span> =&gt; <span class="variable">$v</span>) &#123;</span><br><span class="line">            <span class="variable">$data</span>[<span class="string">'body'</span>][] = <span class="keyword">array</span>(</span><br><span class="line">                <span class="string">'update'</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">                    <span class="string">'_id'</span> =&gt; <span class="variable">$v</span>[<span class="string">'id'</span>]</span><br><span class="line">                )</span><br><span class="line">            );</span><br><span class="line">            <span class="variable">$data</span>[<span class="string">'body'</span>][][<span class="string">'doc'</span>][<span class="variable">$v</span>[<span class="string">'field_name'</span>]] = <span class="variable">$v</span>[<span class="string">'value'</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$res</span> = <span class="variable">$this</span>-&gt;client-&gt;bulk(<span class="variable">$data</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$res</span>[<span class="string">'errors'</span>] == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//批量删除 </span></span><br><span class="line">    <span class="comment">/*</span><br><span class="line">    *<span class="phpdoc"> @ids</span> = array()</span><br><span class="line">    */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">delDocs</span><span class="params">(<span class="variable">$ids</span>)</span> </span>&#123;</span><br><span class="line">        <span class="variable">$data</span> = <span class="variable">$this</span>-&gt;data;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$ids</span> <span class="keyword">as</span> <span class="variable">$id</span>) &#123;</span><br><span class="line">            <span class="variable">$data</span>[<span class="string">'body'</span>][] = <span class="keyword">array</span>(</span><br><span class="line">                <span class="string">'delete'</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">                    <span class="string">'_id'</span> =&gt; <span class="variable">$id</span></span><br><span class="line">                )</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$res</span> = <span class="variable">$this</span>-&gt;client-&gt;bulk(<span class="variable">$data</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$res</span>[<span class="string">'errors'</span>] === <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h5 id="更新一条">更新一条</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span><span class="params">(<span class="variable">$doc</span>)</span> </span>&#123;</span><br><span class="line">    <span class="variable">$data</span> = <span class="variable">$this</span>-&gt;data;</span><br><span class="line">    <span class="variable">$data</span>[<span class="string">'id'</span>] = <span class="variable">$doc</span>[<span class="string">'id'</span>];</span><br><span class="line">      <span class="variable">$data</span>[<span class="string">'body'</span>][<span class="string">'doc'</span>] =<span class="variable">$doc</span>; </span><br><span class="line">  </span><br><span class="line">    <span class="variable">$response</span> = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$this</span>-&gt;client-&gt;update(<span class="variable">$data</span>)) &#123;</span><br><span class="line">            <span class="variable">$response</span> = <span class="keyword">true</span>;</span><br><span class="line">        &#125;   </span><br><span class="line">    &#125; <span class="keyword">catch</span> (<span class="keyword">Exception</span> <span class="variable">$e</span>) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;   </span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$response</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="关闭Selinux">关闭Selinux</h5><p> linux使用iptables关闭防火墙，但是访问ElasticServer的使用还是报Permission denie错误，最后发现原来<br>Selinx还是开着，原来iptables -F 有时候不能关闭所有的防火墙策略，使用下面命令关闭selinux </p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setenforce <span class="number">0</span> <span class="comment">#不需要重启</span></span><br></pre></td></tr></table></figure>
<h5 id="结果输出">结果输出</h5><pre><code>data = [doc <span class="keyword">for</span> doc <span class="keyword">in</span> <span class="literal">result</span>['hits']['hits']]
print data
</code></pre><h5 id="Mongodb和ElasticSearch对比">Mongodb和ElasticSearch对比</h5><p>Mongodb在数据量很大时候查询速度很慢即使添加了索引，所以对使用skip来获取分页信息，官方强烈建议是使用<br>条件过滤，es使用倒排索引，虽然在索引建立的时候需要花费些时间，但是对于数据的查询速度却表现非常的好!<br><img src="/images/php/mongodvses.png" alt="Alt text"></p>
</li>
</ol>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/Elasticsearch/">Elasticsearch</a><a href="/tags/php/">php</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/10/04/elasticsearch/#comments" class="ds-thread-count comments-count-link" data-thread-key="2015/10/04/elasticsearch/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/10/04/sklearn/" title="sklearn文本分类学习" itemprop="url">sklearn文本分类学习</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Jackie wu" target="_blank" itemprop="author">Jackie wu</a>
		
  <p class="article-time">
    <time datetime="2015-10-04T02:27:28.000Z" itemprop="datePublished"> 发表于 2015-10-04</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h6 id="文本分类数据加载">文本分类数据加载</h6><pre><code>开始学习NLP了，想使用实验室的微博数据做个文本分类但是在使用Scikit-learn的时候，总是没有思路，不知道如何把自己的数据转换为训练分类器所能运行的格式，后来看学长的解释，Scikit-learn的输入都是2维的数组，于是考虑直接把数据转换为2维数组然后传入分类器查看结果。
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> jieba</span><br><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> TfidfVectorizer</span><br><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> CountVectorizer</span><br><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> TfidfTransformer</span><br><span class="line"><span class="keyword">from</span> sklearn.naive_bayes <span class="keyword">import</span> MultinomialNB</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    categories_dict = &#123;<span class="string">'1'</span> : <span class="string">'饮食'</span>,<span class="string">'2'</span> : <span class="string">'新闻'</span>&#125;</span><br><span class="line"></span><br><span class="line">    X = [</span><br><span class="line">        <span class="string">'我爱吃大米'</span>,</span><br><span class="line">        <span class="string">'喜欢馒头'</span>,</span><br><span class="line">        <span class="string">'喜欢盖浇饭'</span>,</span><br><span class="line">        <span class="string">'烧鸡'</span>,</span><br><span class="line">        <span class="string">'番茄炒蛋'</span>,</span><br><span class="line">        <span class="string">'拉面'</span>,</span><br><span class="line">        <span class="string">'本报记者陈雪频实习记者唐翔发自上海'</span>,</span><br><span class="line">        <span class="string">'记者消息来自北京'</span>,</span><br><span class="line">        <span class="string">'北京台报道'</span>,</span><br><span class="line">        <span class="string">'记者消息来自北京'</span>,</span><br><span class="line">        <span class="string">'记者消息来自北京'</span>,</span><br><span class="line">        <span class="string">'记者消息来自北京'</span>,</span><br><span class="line"></span><br><span class="line">    ]</span><br><span class="line">    categories= [<span class="string">'1'</span>,<span class="string">'1'</span>,<span class="string">'1'</span>,<span class="string">'1'</span>,<span class="string">'1'</span>,<span class="string">'1'</span>,<span class="string">'2'</span>,<span class="string">'2'</span>,<span class="string">'2'</span>,<span class="string">'2'</span>,<span class="string">'2'</span>,<span class="string">'2'</span>]</span><br><span class="line">    dataset = []</span><br><span class="line">    <span class="keyword">for</span> data <span class="keyword">in</span> X:</span><br><span class="line">        dataset.append(<span class="string">" "</span>.join(jieba.cut(data.split(<span class="string">','</span>)[<span class="number">0</span>], cut_all=<span class="keyword">False</span>)))</span><br><span class="line">    count_vect = CountVectorizer()</span><br><span class="line">    X_train_counts = count_vect.fit_transform(dataset)</span><br><span class="line">    tfidf_transformer = TfidfTransformer()</span><br><span class="line">    X_train_tfidf = tfidf_transformer.fit_transform(X_train_counts)</span><br><span class="line">    vect = TfidfVectorizer()</span><br><span class="line">    clf = MultinomialNB().fit(X_train_tfidf, categories)</span><br><span class="line">    docs_new = [<span class="string">'记者'</span>,<span class="string">'大米'</span>]</span><br><span class="line">    X_new_counts = count_vect.transform(docs_new)</span><br><span class="line">    X_new_tfidf = tfidf_transformer.transform(X_new_counts)</span><br><span class="line">    <span class="keyword">print</span> X_new_tfidf</span><br><span class="line">    predicted = clf.predict(X_new_tfidf)</span><br><span class="line">    <span class="keyword">print</span> predicted</span><br><span class="line">    <span class="keyword">for</span> doc, category <span class="keyword">in</span> zip(docs_new, predicted):</span><br><span class="line">        print(<span class="string">'%r =&gt; %s'</span> % (doc, categories_dict[category]))</span><br><span class="line"><span class="keyword">if</span> __name__ ==<span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>补充一点再做分类器的时候，数据的大小会直接影响分类器的结果，如果数据量不够或者太少会造成数据的分类错误，所以尽可能使用更多的数据。</p>
<h6 id="交叉验证">交叉验证</h6><p> 交叉验证是一种统计学上将数据样本切割成较小子集的实用方法。于是可以先在一个子集上做分析， 而其它子集则用来做后续对此分析的确认及验证。交叉验证首先要做的就是划分样本集为样本集和测试集两部分，随后使用样本集训练分类器，然后使用测试集验证分类器的正确性。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> jieba</span><br><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> TfidfVectorizer</span><br><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> CountVectorizer</span><br><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> TfidfTransformer</span><br><span class="line"><span class="keyword">from</span> sklearn.naive_bayes <span class="keyword">import</span> MultinomialNB</span><br><span class="line"><span class="keyword">from</span> sklearn.cross_validation <span class="keyword">import</span> train_test_split</span><br><span class="line"><span class="keyword">from</span> sklearn.externals <span class="keyword">import</span> joblib</span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> accuracy_score</span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> roc_curve</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> roc_auc_score</span><br><span class="line">TEST_SIZE = <span class="number">0.2</span></span><br><span class="line">RANDOM_STATE = <span class="number">0</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    categories_dict = &#123;<span class="number">1</span> : <span class="string">'饮食'</span>,<span class="number">2</span> : <span class="string">'新闻'</span>&#125;</span><br><span class="line"></span><br><span class="line">    X = [</span><br><span class="line">        <span class="string">'我爱吃大米'</span>,</span><br><span class="line">        <span class="string">'喜欢馒头'</span>,</span><br><span class="line">        <span class="string">'喜欢盖浇饭'</span>,</span><br><span class="line">        <span class="string">'烧鸡'</span>,</span><br><span class="line">        <span class="string">'番茄炒蛋'</span>,</span><br><span class="line">        <span class="string">'拉面'</span>,</span><br><span class="line">        <span class="string">'本报记者陈雪频实习记者唐翔发自上海'</span>,</span><br><span class="line">        <span class="string">'记者消息来自北京'</span>,</span><br><span class="line">        <span class="string">'北京台报道'</span>,</span><br><span class="line">        <span class="string">'记者消息来自北京'</span>,</span><br><span class="line">        <span class="string">'记者消息来自北京'</span>,</span><br><span class="line">        <span class="string">'记者消息来自北京'</span>,</span><br><span class="line"></span><br><span class="line">    ]</span><br><span class="line">    categories= [<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>]</span><br><span class="line">    X_train, X_val, y_train, y_val = train_test_split(X, categories, test_size=TEST_SIZE, random_state=RANDOM_STATE)  //样本集划分</span><br><span class="line">    dataset = []</span><br><span class="line">    <span class="keyword">for</span> data <span class="keyword">in</span> X_train:</span><br><span class="line">        dataset.append(<span class="string">" "</span>.join(jieba.cut(data.split(<span class="string">','</span>)[<span class="number">0</span>], cut_all=<span class="keyword">False</span>)))</span><br><span class="line">    count_vect = CountVectorizer()</span><br><span class="line">    X_train_counts = count_vect.fit_transform(dataset)</span><br><span class="line">    tfidf_transformer = TfidfTransformer()</span><br><span class="line">    X_train_tfidf = tfidf_transformer.fit_transform(X_train_counts)</span><br><span class="line">    vect = TfidfVectorizer()</span><br><span class="line">    clf = MultinomialNB(alpha=<span class="number">0.1</span>).fit(X_train_tfidf, y_train)</span><br><span class="line">    joblib.dump(clf, <span class="string">"train_model.m"</span>)</span><br><span class="line">    X_train_test = []</span><br><span class="line">    doc_new_set = []</span><br><span class="line">    <span class="keyword">for</span> data <span class="keyword">in</span>  X_val:</span><br><span class="line">        doc_new_set.append(<span class="string">" "</span>.join(jieba.cut(data.split(<span class="string">','</span>)[<span class="number">0</span>], cut_all=<span class="keyword">False</span>)))</span><br><span class="line">    X_new_counts = count_vect.transform(doc_new_set)</span><br><span class="line">    X_new_tfidf = tfidf_transformer.transform(X_new_counts)</span><br><span class="line">    <span class="comment">#print clf.predict(X_new_tfidf)</span></span><br><span class="line">    y_pred = clf.predict_proba(X_new_tfidf)[:, <span class="number">1</span>] //分类可能性预测</span><br><span class="line">    new_pred = []</span><br><span class="line">    <span class="keyword">for</span> d <span class="keyword">in</span>  y_pred:</span><br><span class="line">        new_pred.append(d)</span><br><span class="line">    fpr, tpr, thresholds = roc_curve(y_val,new_pred, pos_label=<span class="number">2</span>) //roc曲线</span><br><span class="line">    <span class="keyword">print</span> fpr,tpr,thresholds</span><br><span class="line">    docs_new = [<span class="string">'记者'</span>,<span class="string">'米饭'</span>]</span><br><span class="line">    X_new_counts = count_vect.transform(docs_new)</span><br><span class="line">    X_new_tfidf = tfidf_transformer.transform(X_new_counts)</span><br><span class="line">    <span class="comment">#print X_new_tfidf</span></span><br><span class="line">    predicted = clf.predict(X_new_tfidf)  //分类预测</span><br><span class="line">    <span class="comment">#print predicted</span></span><br><span class="line">    <span class="keyword">for</span> doc, category <span class="keyword">in</span> zip(docs_new, predicted):</span><br><span class="line">        <span class="keyword">print</span> doc, categories_dict[category]</span><br><span class="line"><span class="keyword">if</span> __name__ ==<span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<h6 id="分类器的保存和恢复">分类器的保存和恢复</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">joblib.dump(clf, <span class="string">"train_model.m"</span>)</span><br><span class="line">clf = joblib.load(<span class="string">"train_model.m"</span>)</span><br></pre></td></tr></table></figure>
<h6 id="几个分类器测试">几个分类器测试</h6><p>分别使用NB、SVM、LogisticRegression、KNN分类器，： 对于文本分类问题来说，数据的特征可以是：词频特征、TF-IDF特征等. 由于词袋的规模非常的大，我们可以使用Hashing Trick 技巧来进行降维操作。当然，Hashing Trick的参数选择非常重要，太大了会导致运行缓慢甚至内存溢出，太低了会导致碰撞的几率加大，降低模型准确性。HashingTrick<a href="http://myg0u.com/%E6%95%B0%E6%8D%AE%E6%8C%96%E6%8E%98/2015/05/06/use-sklearn-jieba.html" target="_blank" rel="external">参考文章</a><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">     <span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> jieba</span><br><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> TfidfVectorizer</span><br><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> CountVectorizer</span><br><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> TfidfTransformer</span><br><span class="line"><span class="keyword">from</span> sklearn.naive_bayes <span class="keyword">import</span> MultinomialNB</span><br><span class="line"><span class="keyword">from</span> sklearn.cross_validation <span class="keyword">import</span> train_test_split</span><br><span class="line"><span class="keyword">from</span> sklearn.externals <span class="keyword">import</span> joblib</span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> accuracy_score</span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> roc_curve</span><br><span class="line"><span class="keyword">from</span> sklearn.grid_search <span class="keyword">import</span> GridSearchCV</span><br><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> LogisticRegression</span><br><span class="line"><span class="keyword">from</span> sklearn.neighbors <span class="keyword">import</span> KNeighborsClassifier</span><br><span class="line"><span class="keyword">from</span> sklearn.feature_selection <span class="keyword">import</span> chi2</span><br><span class="line"><span class="keyword">from</span> sklearn.feature_selection <span class="keyword">import</span> SelectKBest</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> sklearn.svm <span class="keyword">import</span> SVC</span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> roc_auc_score</span><br><span class="line"><span class="keyword">from</span> sklearn.feature_extraction <span class="keyword">import</span> FeatureHasher</span><br><span class="line">TEST_SIZE = <span class="number">0.2</span></span><br><span class="line">RANDOM_STATE = <span class="number">0</span></span><br><span class="line">X = []</span><br><span class="line">categories = []</span><br><span class="line"><span class="keyword">with</span> open( <span class="string">'data.csv'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    reader = csv.reader(f)</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> reader:</span><br><span class="line">        X.append(row[<span class="number">0</span>])</span><br><span class="line">        categories.append(row[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">categories_dict = &#123;<span class="number">1</span> : <span class="string">'男'</span>, <span class="number">0</span>: <span class="string">'女'</span>&#125;</span><br><span class="line">dataset = []</span><br><span class="line"><span class="keyword">for</span> data <span class="keyword">in</span> X:</span><br><span class="line">    dataset.append(<span class="string">" "</span>.join(jieba.cut(data.split(<span class="string">','</span>)[<span class="number">0</span>], cut_all=<span class="keyword">False</span>)))</span><br><span class="line">count_vect = CountVectorizer()</span><br><span class="line">X_train_counts = count_vect.fit_transform(dataset)</span><br><span class="line">tfidf_transformer = TfidfTransformer()</span><br><span class="line">X_train_tfidf = tfidf_transformer.fit_transform(X_train_counts)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">SVM</span><span class="params">()</span>:</span></span><br><span class="line">    clf = SVC(kernel=<span class="string">'linear'</span>)</span><br><span class="line">    clf.fit(X_train_tfidf, categories)</span><br><span class="line">    joblib.dump(clf, <span class="string">"svm_model.m"</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">MultionmialNB</span><span class="params">()</span>:</span></span><br><span class="line">    clf = MultinomialNB(alpha=<span class="number">0.1</span>).fit(X_train_tfidf, categories)</span><br><span class="line">    joblib.dump(clf,<span class="string">'multionmialnb.m'</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Hashing</span><span class="params">()</span>:</span></span><br><span class="line">    X = []</span><br><span class="line">    categories = []</span><br><span class="line">    <span class="keyword">with</span> open( <span class="string">'data.csv'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        reader = csv.reader(f)</span><br><span class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> reader:</span><br><span class="line">            X.append(row[<span class="number">0</span>])</span><br><span class="line">            categories.append(row[<span class="number">1</span>])</span><br><span class="line">    fh = FeatureHasher(n_features=<span class="number">30000</span>,non_negative=<span class="keyword">True</span>,input_type=<span class="string">'string'</span>)</span><br><span class="line">    docset = []</span><br><span class="line">    <span class="keyword">for</span> d <span class="keyword">in</span> X:</span><br><span class="line">        docset += [jieba.cut(d)]</span><br><span class="line">    X_train =  fh.fit_transform(docset)</span><br><span class="line">    clf = MultinomialNB(alpha=<span class="number">0.1</span>).fit(X_train, categories)</span><br><span class="line">    str =<span class="string">'最喜欢冰淇淋了'</span></span><br><span class="line">    <span class="keyword">print</span> clf.predict(fh.fit_transform(jieba.cut(str)))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">LinerClassifer</span><span class="params">()</span>:</span> //Logistic regression </span><br><span class="line"></span><br><span class="line">    lr =LogisticRegression()</span><br><span class="line">    lr.fit(X_train_tfidf,categories)</span><br><span class="line">    joblib.dump(lr, <span class="string">"logisticregression_model.m"</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">KNN</span><span class="params">()</span>:</span>   //KNN</span><br><span class="line">    knnclf = KNeighborsClassifier()</span><br><span class="line">    knnclf.fit(X_train_tfidf,categories)</span><br><span class="line">    joblib.dump(knnclf, <span class="string">"knn_model.m"</span>)</span><br><span class="line"><span class="keyword">if</span> __name__ ==<span class="string">"__main__"</span>:</span><br><span class="line">    <span class="comment"># MultionmialNB()</span></span><br><span class="line">    <span class="comment"># SVM()</span></span><br><span class="line">    <span class="comment"># LinerClassifer()</span></span><br><span class="line">    clf = joblib.load(<span class="string">'multionmialnb.m'</span>)</span><br><span class="line">    str =[<span class="string">'宝宝乖啊'</span>]</span><br><span class="line">    doc_new_set = []</span><br><span class="line">    <span class="keyword">for</span> data <span class="keyword">in</span>  str:</span><br><span class="line">        doc_new_set.append(<span class="string">" "</span>.join(jieba.cut(data.split(<span class="string">','</span>)[<span class="number">0</span>], cut_all=<span class="keyword">False</span>)))</span><br><span class="line">    X_new_counts = count_vect.transform(doc_new_set)</span><br><span class="line">    X_new_tfidf = tfidf_transformer.transform(X_new_counts)</span><br><span class="line">    <span class="keyword">print</span> clf.predict(X_new_tfidf)</span><br></pre></td></tr></table></figure></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/python/">python</a><a href="/tags/sklearn/">sklearn</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/10/04/sklearn/#comments" class="ds-thread-count comments-count-link" data-thread-key="2015/10/04/sklearn/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/07/25/file-upload-iframe/" title="Iframe实现文件上传" itemprop="url">Iframe实现文件上传</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Jackie wu" target="_blank" itemprop="author">Jackie wu</a>
		
  <p class="article-time">
    <time datetime="2015-07-25T10:01:45.000Z" itemprop="datePublished"> 发表于 2015-07-25</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>  文件上传有很多方式，原生的php或者使用jQuery文件上传插件，本文就介绍下一个最近Get的使用Iframe进行文件上传的方式： </p>
<ol>
<li>首先定义iframe，Iframe指定另一个页面在另一个页面中实现文件的上传功能这里的export/img会渲染应为一个文件选择和上传的页面 <iframe id="zyj_upload" src="/export/img" allowtransparency="true" width="200" height="35" frameborder="0" scrolling="no" style="vertical-align:bottom;"></iframe></li>
<li><p>文件选择和上传页面</p>
<pre><code> <span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">""</span> <span class="attribute">method</span>=<span class="value">"post"</span> <span class="attribute">enctype</span>=<span class="value">"multipart/form-data"</span>&gt;</span>
    <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"file"</span> <span class="attribute">name</span>=<span class="value">"f_file"</span> <span class="attribute">id</span>=<span class="value">"f_file"</span>&gt;</span>
    <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"submit"</span> <span class="attribute">id</span>=<span class="value">"f_submit"</span>&gt;</span>
<span class="tag">&lt;/<span class="title">form</span>&gt;</span>
<span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span> <span class="attribute">src</span>=<span class="value">"./js/jquery.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
<span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span>&gt;</span><span class="javascript">
    <span class="built_in">document</span>.domain = <span class="string">'9you.com'</span>;
    $(<span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>{
        $(<span class="string">'#f_file'</span>).change(<span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>{
            $(<span class="string">'#f_submit'</span>).trigger(<span class="string">'click'</span>);
        });
    });
</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
</code></pre></li>
<li><p>文件上传后的后台处理</p>
<pre><code>     <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">fileUploadAction</span><span class="params">()</span> </span>{
       <span class="keyword">if</span> (<span class="variable">$_FILES</span>) {
    <span class="variable">$uploadConfig</span> = <span class="keyword">array</span>(
        <span class="string">'allowed_ext'</span> =&gt; <span class="string">'jpg|png'</span>,
        <span class="string">'ftp'</span> =&gt; <span class="keyword">array</span>(
            <span class="string">'host'</span> =&gt; <span class="string">'180.153.121.62'</span>,
            <span class="string">'user'</span> =&gt; <span class="string">'uploadfile'</span>,
            <span class="string">'pass'</span> =&gt; <span class="string">'gxN!iBMxV2sdYdS3kB2Q58n'</span>,
            <span class="string">'path'</span> =&gt; <span class="string">'/msteam/'</span>,
            <span class="string">'url'</span> =&gt; <span class="string">'http://xxx.com/uploadfile/msteam/'</span> <span class="comment">//(http://static.9you.com/uploadfile/zhibo/%27) </span>
        ),
        <span class="string">'field_name'</span> =&gt; <span class="string">'f_file'</span>,
        <span class="string">'max_size'</span> =&gt; <span class="string">'2M'</span>,
        <span class="string">'upload_dir'</span> =&gt; APP_PATH . <span class="string">'../public/upload/'</span> . date(<span class="string">'Ymd'</span>) . <span class="string">'/'</span>,
        <span class="string">'upload_url'</span> =&gt; <span class="string">'http://xxx.com/'</span>, <span class="comment">//(http://static.9you.com/%27) </span>
        <span class="string">'thumbnails'</span> =&gt; <span class="keyword">array</span>(
            <span class="number">0</span> =&gt; <span class="keyword">array</span>(
                <span class="string">'width'</span> =&gt; <span class="number">150</span>,
                <span class="string">'height'</span> =&gt; <span class="number">150</span>,
                <span class="string">'cut'</span> =&gt; <span class="number">1</span>,
                <span class="string">'path'</span> =&gt; <span class="string">'/150/'</span>
            )
        )
    );
    <span class="keyword">if</span> (Yaf_Application::app()-&gt;environ() != <span class="string">'develop'</span>) {
        <span class="variable">$uploadConfig</span>[<span class="string">'ftp'</span>][<span class="string">'host'</span>] = <span class="string">'180.153.121.62'</span>;
    }

    <span class="variable">$fileUploader</span> = <span class="keyword">new</span> \FileUploader(<span class="variable">$uploadConfig</span>);

    <span class="keyword">try</span> {
        <span class="variable">$result</span> = <span class="variable">$fileUploader</span>-&gt;handleUpload();
        Yaf_Registry::get(<span class="string">'logger'</span>)-&gt;debug(<span class="variable">$result</span>);
    } <span class="keyword">catch</span> (<span class="keyword">Exception</span> <span class="variable">$e</span>) {

        Yaf_Registry::get(<span class="string">'logger'</span>)-&gt;debug(<span class="variable">$e</span>);
    }
    <span class="variable">$returnArr</span> = <span class="keyword">array</span>(
        <span class="string">'success'</span> =&gt; <span class="keyword">false</span>,
        <span class="string">'errmsg'</span> =&gt; <span class="string">'文件上传失败'</span>
    );

    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$result</span>[<span class="string">'success'</span>]) &amp;&amp; <span class="variable">$result</span>[<span class="string">'success'</span>]) {
        <span class="variable">$returnArr</span> = <span class="keyword">array</span>(
            <span class="string">'success'</span> =&gt; <span class="keyword">true</span>,
            <span class="comment">//'url' =&gt; $result['file_url'],</span>
            <span class="string">'url'</span> =&gt; <span class="variable">$result</span>[<span class="string">'thumb'</span>][<span class="string">'/150x150/'</span>],
        );
    } <span class="keyword">else</span> {
        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$result</span>[<span class="string">'error'</span>])) {
            <span class="variable">$returnArr</span>[<span class="string">'errmsg'</span>] = <span class="variable">$result</span>[<span class="string">'error'</span>];
        }
    }

    <span class="comment">//建立结果回调</span>
    <span class="variable">$return</span> = <span class="string">''</span>;
    <span class="variable">$return</span> .= <span class="string">'&lt;script type="text/javascript"&gt;'</span>;
    <span class="variable">$return</span> .= <span class="string">'document.domain = "9you.com";'</span>;
    <span class="variable">$return</span> .= <span class="string">'parent.acrossupload('</span> . json_encode(<span class="variable">$returnArr</span>) . <span class="string">');'</span>;
    <span class="variable">$return</span> .= <span class="string">'&lt;/script&gt;'</span>;
    <span class="keyword">echo</span> <span class="variable">$return</span>;

    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$result</span>[<span class="string">'success'</span>]) &amp;&amp; <span class="variable">$result</span>[<span class="string">'success'</span>]) {

    }
}
}
</code></pre></li>
<li><p>结果显示在调用Iframe的页面中添加结果处理方法： </p>
<p> document.domain = ‘xxx.com’;<br>function acrossupload(res) {<br> console.log(res);<br> $(‘.touxiang2’).attr(‘src’, res.url);<br> $(‘#hidden_logo’).val(res.url);<br>}<br>至此，使用Iframe进行文件上传的功能已经完成！</p>
</li>
</ol>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/fitleupload/">fitleupload</a><a href="/tags/js/">js</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/07/25/file-upload-iframe/#comments" class="ds-thread-count comments-count-link" data-thread-key="2015/07/25/file-upload-iframe/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/06/23/storm/" title="Storm伪分布式单机环境" itemprop="url">Storm伪分布式单机环境</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Jackie wu" target="_blank" itemprop="author">Jackie wu</a>
		
  <p class="article-time">
    <time datetime="2015-06-23T14:25:47.000Z" itemprop="datePublished"> 发表于 2015-06-23</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>Storm伪分布式单机环境安装，内容参考<em>Storm分布式实时计算模式</em>书中内容，进行搭建环境CentosZookeeper安装很简单参考官网进行下载：<a href="http://www.apache.org/dyn/closer.cgi/zookeeper/" target="_blank" rel="external">官网</a>Zookeeper的使用也很简单参考个<a href="http://zookeeper.apache.org/doc/r3.4.6/zookeeperStarted.html#sc_InstallingSingleMode" target="_blank" rel="external">官网文档</a>进行单机的Standalone配置。</p>
<ol>
<li><p>安装依赖包</p>
<p> yum install uuid*<br> yum install libtool<br> yum install libuuid<br> yum install libuuid-devel  </p>
</li>
<li><p>安装Git和Maven更新安装数据源</p>
<p> [root@git ~]# cd src/<br> [root@git src]# wget <a href="http://dl.fedoraproject.org/pub/epel/5/x86_64/epel-release-5-4.noarch.rpm" target="_blank" rel="external">http://dl.fedoraproject.org/pub/epel/5/x86_64/epel-release-5-4.noarch.rpm</a><br> [root@git src]# rpm -ivh epel-release-5-4.noarch.rpm<br> Preparing…                ########################################### [100%]</p>
<pre><code><span class="keyword">package</span> epel-<span class="keyword">release</span>-<span class="number">5</span>-<span class="number">4</span>.noarch <span class="keyword">is</span> already installed
</code></pre><p> [root@git ~]# yum list<br> [root@git ~]# yum install -y git<br>maven的yum安装参考Stackoverflow<a href="http://stackoverflow.com/questions/7532928/how-do-i-install-maven-with-yum" target="_blank" rel="external">问题</a></p>
<p> wget <a href="http://repos.fedorapeople.org/repos/dchen/apache-maven/epel-apache-maven.repo" target="_blank" rel="external">http://repos.fedorapeople.org/repos/dchen/apache-maven/epel-apache-maven.repo</a> -O /etc/yum.repos.d/epel-apache-maven.repo<br> yum install apache-maven<br>安装后发现mvn并没有加入到环境变量： </p>
<p> rpm -ql  apache（查找rpm包的安装路径）<br>export PATH=$PATH:/user/share/apache-maven/bin<br>启动Storm出现问题：<br>(注意yaml格式的要求,空格tab,:和-前后都有空格) 下面都是由于配置文件没有正确设置造成的</p>
<p>  in ‘reader’, line 27, column 1:<br> 　　- 6701<br>Storm运行：</p>
<ol>
<li>启动zookeeper<br> ./zkServer.sh start </li>
<li>启动nimbus 和Supervisor<br> storm nimbus &amp;<br> storm supervisor &amp; </li>
</ol>
</li>
<li><p>日志查看<br>zookeeper日志文件：　bin/ cat zookeeper.out 查看错误日志<br>storm错误日志：storm/logs 下面有nimbus和supervisor日志错误信息<br>但看到如下信息时nimbus就已经启动成功 </p>
<p> 3534 nimbus<br> 3514 QuorumPeerMain<br> 3591 Jps<br>试着访问本地地址： localhost:8080<br>发现不能访问，但是 netstat -ano |grep 8080看到8080端口正在运行中，所以怀疑是防火墙<br>问题iptables -F（关闭防火墙）重新访问,一切正常访问！搭建成功！</p>
</li>
</ol>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/storm/">storm</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/06/23/storm/#comments" class="ds-thread-count comments-count-link" data-thread-key="2015/06/23/storm/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/05/24/scrapy/" title="scrapy学习" itemprop="url">scrapy学习</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Jackie wu" target="_blank" itemprop="author">Jackie wu</a>
		
  <p class="article-time">
    <time datetime="2015-05-24T13:07:20.000Z" itemprop="datePublished"> 发表于 2015-05-24</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>   由于数据分析需要使用twitter进行数据分析，于是考虑使用python的爬虫框架搭建Twitter的数据抓取功能，关于scrapy的使用和教程<a href="http://doc.scrapy.org/en/latest/intro/tutorial.html" target="_blank" rel="external">参考</a><br>  Scrapy的环境搭建参考教程使用</p>
<pre><code>pip <span class="keyword">install</span> scrapy 
</code></pre><p> 搭建好之后参考教程建立一个startup的项目，中间却出现</p>
<pre><code><span class="constant">ImportError</span><span class="symbol">:</span> <span class="constant">Error</span> loading object <span class="string">'scrapy.core.downloader.handlers.s3.S3DownloadHandler'</span><span class="symbol">:</span> <span class="constant">No</span> <span class="class"><span class="keyword">module</span> <span class="title">named</span> <span class="title">win32api</span></span>
分析确实pywin32找了半天资料最好解决方法：
</code></pre><p>　在下面地址下载相应的pywin32的win32包，发到python安装目录的Scripts下执行:<br>　  easy_install.exe  easy_install.exe pywin32-219.win32-py2.7.exe<br>完成后再议运行scrapy crawl dmoz运行成功！</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/网络爬虫/">网络爬虫</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/05/24/scrapy/#comments" class="ds-thread-count comments-count-link" data-thread-key="2015/05/24/scrapy/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/04/19/android-blog-4/" title="Android应用开发四" itemprop="url">Android应用开发四</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Jackie wu" target="_blank" itemprop="author">Jackie wu</a>
		
  <p class="article-time">
    <time datetime="2015-04-19T06:46:10.000Z" itemprop="datePublished"> 发表于 2015-04-19</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>首先关于上次遇到的问题，就是使用jsoup抓取网页时候一直报错，后来查找发现<br>不能直接在Android的MainActivity线程中直接调用http请求，所以可以通过重新启动一个线程<br>来完成，同时需要进行多线程之间的通讯使用Message和Handler类实现进程之间的通信传送数据。代码参考</p>
<pre><code>mHandler = <span class="keyword">new</span> Handler() {    
            @Override    
            <span class="keyword">public</span> <span class="keyword">void</span> handleMessage(Message msg) {    
                myadapter=<span class="keyword">new</span>  MySimpleAdapter(MainActivity.<span class="keyword">this</span>,newsDataList,R.layout.data_list);
                listView.setAdapter(myadapter);  

                listView.setOnItemClickListener(<span class="keyword">new</span> OnItemClickListener(){

                    @Override
                    <span class="keyword">public</span> <span class="keyword">void</span> onItemClick(AdapterView&lt;?&gt; adapter, View v, <span class="built_in">int</span> position,
                            <span class="keyword">long</span> id) {
                        System.out.<span class="built_in">println</span>(v);
                        Item t = (Item)newsDataList.<span class="built_in">get</span>(position);
                        Intent it = <span class="keyword">new</span> Intent(MainActivity.<span class="keyword">this</span>,ItemDetail.class) ;
                        it.putExtra(<span class="string">"blog_id"</span>, t.getId());
                        MainActivity.<span class="keyword">this</span>.startActivity(it) ;

                    }

                });
            }    
        };    
        <span class="keyword">new</span> Thread(runnable).start();
Runnable runnable = <span class="keyword">new</span> Runnable(){
@Override
<span class="keyword">public</span> <span class="keyword">void</span> run() {
    <span class="keyword">String</span> blog_url = <span class="string">"http://blog.csdn.net/xxxx"</span>;
    Document doc =<span class="keyword">null</span>;
    <span class="keyword">try</span> {
        doc = Jsoup.connect(blog_url).userAgent(<span class="string">"Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/27.0.1453.110 Safari/537.36"</span>).timeout(<span class="number">5000</span>).<span class="built_in">get</span>();
    } <span class="keyword">catch</span> (IOException e) {
        e.printStackTrace();
    }
    <span class="keyword">if</span>(doc !=<span class="keyword">null</span>){
        Elements news = doc.select(<span class="string">"#article_list span.link_title a"</span>);
        List&lt;Item&gt; blogs = <span class="keyword">new</span> ArrayList&lt;Item&gt;();
        <span class="keyword">for</span>(Element link: news){
            <span class="keyword">String</span> href = link.attr(<span class="string">"href"</span>);

            <span class="keyword">String</span> id = href.substring(href.length()-<span class="number">8</span>,href.length());
            Log.i(<span class="string">"id="</span>,id);
            Item item = <span class="keyword">new</span> Item(id,link.<span class="built_in">text</span>());
            newsDataList.<span class="built_in">add</span>(item);
        }
         mHandler.sendEmptyMessage(<span class="number">0</span>); 
    }<span class="keyword">else</span>{
        Log.i(<span class="string">"data="</span>, <span class="keyword">String</span>.valueOf(<span class="number">1234124</span>));
    }
}
};
</code></pre><p>然后把以前的进入主页面的Splash程序和使用ActionBar创建下拉菜单的操作也加进去,这个练手程序就到此为止了。上张图片吧。。<br><img src="/images/android/android_blog_4_1.png" alt="Alt text"></p>
<p><a href="http://pan.baidu.com/s/1jGA3oSA" target="_blank" rel="external">代码下载</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/Android开发/">Android开发</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/04/19/android-blog-4/#comments" class="ds-thread-count comments-count-link" data-thread-key="2015/04/19/android-blog-4/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/04/19/android-blog-3/" title="Android应用开发三" itemprop="url">Android应用开发三</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Jackie wu" target="_blank" itemprop="author">Jackie wu</a>
		
  <p class="article-time">
    <time datetime="2015-04-19T06:44:53.000Z" itemprop="datePublished"> 发表于 2015-04-19</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="使用webview">使用webview</h3><p> 由于需要浏览网页内容所以，所以考虑使用webView直接加载原来网页中的内容来显示。<br> 网络因素所以使用本地的html文件加速文件的显示。<br> 一个小的技巧，使用顶部导航栏时，图标点击和不点击显示不同颜色可以设置一个html文件比如<br>main.xml文件</p>
<pre><code>&lt;ImageView
      android:<span class="variable">id=</span><span class="string">"@+id/news_detail_home"</span>
      android:<span class="variable">layout_width=</span><span class="string">"wrap_content"</span>
      android:<span class="variable">layout_height=</span><span class="string">"wrap_content"</span>
      android:<span class="variable">layout_gravity=</span><span class="string">"left|center"</span>
      android:<span class="variable">background=</span><span class="string">"@drawable/head_home"</span>
      android:<span class="variable">clickable=</span><span class="string">"true"</span> /&gt;
</code></pre><p>在drawable下建立home.xml文件和选择和正常的样式图片：</p>
<pre><code><span class="pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="tag">&lt;<span class="title">selector</span>
  <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span>&gt;</span>
    <span class="tag">&lt;<span class="title">item</span> <span class="attribute">android:state_focused</span>=<span class="value">"true"</span> <span class="attribute">android:drawable</span>=<span class="value">"@drawable/head_home_selected"</span> /&gt;</span>
    <span class="tag">&lt;<span class="title">item</span> <span class="attribute">android:state_selected</span>=<span class="value">"true"</span> <span class="attribute">android:drawable</span>=<span class="value">"@drawable/head_home_selected"</span> /&gt;</span>
    <span class="tag">&lt;<span class="title">item</span> <span class="attribute">android:state_pressed</span>=<span class="value">"true"</span> <span class="attribute">android:drawable</span>=<span class="value">"@drawable/head_home_selected"</span> /&gt;</span>
    <span class="tag">&lt;<span class="title">item</span> <span class="attribute">android:drawable</span>=<span class="value">"@drawable/head_home_normal"</span> /&gt;</span>
<span class="tag">&lt;/<span class="title">selector</span>&gt;</span>
</code></pre><p>最后代码：</p>
<pre><code>&lt;LinearLayout xmlns:<span class="variable">android=</span><span class="string">"http://schemas.android.com/apk/res/android"</span>  
    xmlns:<span class="variable">tools=</span><span class="string">"http://schemas.android.com/tools"</span>
    android:<span class="variable">orientation=</span><span class="string">"vertical"</span>
    android:<span class="variable">layout_width=</span><span class="string">"fill_parent"</span>  
    android:<span class="variable">layout_height=</span><span class="string">"fill_parent"</span>  
    tools:<span class="variable">context=</span><span class="string">".MainActivity"</span> &gt;  
   &lt;FrameLayout
        android:<span class="variable">id=</span><span class="string">"@+id/news_detail_header"</span>
        android:<span class="variable">layout_width=</span><span class="string">"fill_parent"</span>
        android:<span class="variable">layout_height=</span><span class="string">"wrap_content"</span>
        android:<span class="variable">background=</span><span class="string">"@drawable/head_bg"</span>
        android:<span class="variable">gravity=</span><span class="string">"center_vertical"</span>
        android:<span class="variable">orientation=</span><span class="string">"horizontal"</span>
        android:<span class="variable">paddingLeft=</span><span class="string">"2dip"</span>
        android:<span class="variable">paddingRight=</span><span class="string">"2dip"</span> &gt;

        &lt;ImageView
            android:<span class="variable">id=</span><span class="string">"@+id/news_detail_home"</span>
            android:<span class="variable">layout_width=</span><span class="string">"wrap_content"</span>
            android:<span class="variable">layout_height=</span><span class="string">"wrap_content"</span>
            android:<span class="variable">layout_gravity=</span><span class="string">"left|center"</span>
            android:<span class="variable">background=</span><span class="string">"@drawable/head_home"</span>
            android:<span class="variable">clickable=</span><span class="string">"true"</span> /&gt;

    &lt;/FrameLayout&gt;
     &lt;WebView 
         android:<span class="variable">id=</span><span class="string">"@+id/webview"</span>
         android:<span class="variable">layout_width=</span><span class="string">"wrap_content"</span>
         android:<span class="variable">layout_height=</span><span class="string">"wrap_content"</span>
         /&gt;
&lt;/LinearLayout&gt;  
</code></pre><ul>
<li>ItemDetai.java文件</li>
</ul>
<pre><code><span class="keyword">package</span> com.example.blogapp;
<span class="keyword">import</span> android.app.<span class="type">Activity</span>;
<span class="keyword">import</span> android.content.<span class="type">Intent</span>;
<span class="keyword">import</span> android.os.<span class="type">Bundle</span>;
<span class="keyword">import</span> android.view.<span class="type">View</span>;
<span class="keyword">import</span> android.view.<span class="type">View</span>.<span class="type">OnClickListener</span>;
<span class="keyword">import</span> android.webkit.<span class="type">WebView</span>;
<span class="keyword">import</span> android.webkit.<span class="type">WebViewClient</span>;
<span class="keyword">import</span> android.widget.<span class="type">Button</span>;
<span class="keyword">import</span> android.widget.<span class="type">ImageView</span>;
<span class="keyword">import</span> android.widget.<span class="type">TextView</span>;
public <span class="class"><span class="keyword">class</span> <span class="title">ItemDetail</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">Activity</span> {</span>
    <span class="keyword">private</span> <span class="type">ImageView</span> <span class="type">Iv</span> ;
    <span class="keyword">private</span> <span class="type">TextView</span> tv ;
    <span class="keyword">private</span> <span class="type">WebView</span> wv ;
    <span class="keyword">protected</span> void onCreate(<span class="type">Bundle</span> savedInstanceState) {
        <span class="keyword">super</span>.onCreate(savedInstanceState);
        setContentView(<span class="type">R</span>.layout.detail_main);
        <span class="type">Intent</span> intent = getIntent();
        intent.getExtras();
        <span class="type">Bundle</span> data = intent.getExtras();
        <span class="type">String</span> id = data.getString(<span class="string">"blog_id"</span>);
        wv = (<span class="type">WebView</span>) <span class="keyword">this</span>.findViewById(<span class="type">R</span>.id.webview);
        wv.getSettings().setJavaScriptEnabled(<span class="literal">true</span>);  
        wv.loadUrl(<span class="string">"file:///android_asset/index.html"</span>);  
        wv.setWebViewClient(<span class="keyword">new</span> <span class="type">HelloWebViewClient</span> ()); 
        <span class="type">Iv</span> = (<span class="type">ImageView</span>)<span class="keyword">this</span>.findViewById(<span class="type">R</span>.id.news_detail_home);
        <span class="type">Iv</span>.setOnClickListener(<span class="keyword">new</span> <span class="type">OnClickListener</span>(){
            <span class="annotation">@Override</span>
            public void onClick(<span class="type">View</span> v) {
                <span class="type">Intent</span> it = <span class="keyword">new</span> <span class="type">Intent</span>(<span class="type">ItemDetail</span>.<span class="keyword">this</span>,<span class="type">MainActivity</span>.<span class="keyword">class</span>);
                <span class="type">ItemDetail</span>.<span class="keyword">this</span>.startActivity(it);
                <span class="type">ItemDetail</span>.<span class="keyword">this</span>.finish();
            }});
    }

     <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWebViewClient</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">WebViewClient</span> {</span>  
            public boolean shouldOverrideUrlLoading(<span class="type">WebView</span> view, <span class="type">String</span> url) {  
                view.loadUrl(url);  
                <span class="keyword">return</span> <span class="literal">true</span>;  
            }  
        }  

}
</code></pre><p>效果图：</p>
<p><img src="/images/android/android_blog_3_1.png" alt="Alt text"></p>
<p>完整代码下载：<a href="http://pan.baidu.com/s/13rJ8E" target="_blank" rel="external">百度云盘</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/Android开发/">Android开发</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/04/19/android-blog-3/#comments" class="ds-thread-count comments-count-link" data-thread-key="2015/04/19/android-blog-3/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/04/19/android-blog-2/" title="Android应用开发二" itemprop="url">Android应用开发二</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Jackie wu" target="_blank" itemprop="author">Jackie wu</a>
		
  <p class="article-time">
    <time datetime="2015-04-19T06:39:52.000Z" itemprop="datePublished"> 发表于 2015-04-19</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="了解Activity">了解Activity</h3><p><img src="/images/android/android_blog_2.png" alt="Alt text"></p>
<h3 id="了解Intent">了解Intent</h3><p>  在一个项目之中，会由多个Activity程序所组成，那么此时，这多个Activity程序之间就需要进行通讯，而这之间的通讯就依靠Intent完成。<br><img src="/images/android/android_blog_2_2.png" alt="Alt text"><br>示例： </p>
<ul>
<li>MainActivity.java</li>
</ul>
<pre><code><span class="keyword">package</span> com.example.blogapp;
<span class="keyword">import</span> java.util.ArrayList;
<span class="keyword">import</span> java.util.List;
<span class="keyword">import</span> android.app.Activity;
<span class="keyword">import</span> android.content.Intent;
<span class="keyword">import</span> android.os.Bundle;
<span class="keyword">import</span> android.view.Menu;
<span class="keyword">import</span> android.view.View;
<span class="keyword">import</span> android.view.View.OnClickListener;
<span class="keyword">import</span> android.widget.Button;
<span class="keyword">import</span> android.widget.ListView;

<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>{

    <span class="keyword">private</span> Item item ;
    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;Item&gt; newsDataList = <span class="keyword">new</span> ArrayList&lt;Item&gt;();
    <span class="keyword">private</span> ListView listView ;
    <span class="keyword">private</span> MySimpleAdapter myadapter ;
    <span class="keyword">private</span> Button btn ;
    <span class="annotation">@Override</span>
    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>{
        <span class="keyword">super</span>.onCreate(savedInstanceState);

        setContentView(R.layout.main);
        <span class="keyword">this</span>.initNewsData();
        myadapter = <span class="keyword">new</span> MySimpleAdapter(MainActivity.<span class="keyword">this</span>, newsDataList,R.layout.data_list);  
        listView =(ListView) findViewById(R.id.listview);
        listView.setAdapter(myadapter);
        btn = (Button)<span class="keyword">this</span>.findViewById(R.id.btn);
        btn.setOnClickListener(<span class="keyword">new</span> OnClickListener(){
            <span class="annotation">@Override</span>
            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>{
                Intent it = <span class="keyword">new</span> Intent(MainActivity.<span class="keyword">this</span>,ItemDetail.class) ;
                MainActivity.<span class="keyword">this</span>.startActivity(it) ;    
            }


        });

    }
    <span class="annotation">@Override</span>
    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onCreateOptionsMenu</span><span class="params">(Menu menu)</span> </span>{
        getMenuInflater().inflate(R.menu.main, menu);
        <span class="keyword">return</span> <span class="keyword">true</span>;
    }
    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initNewsData</span><span class="params">()</span> </span>{
        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">20</span>; i++) {
            item = <span class="keyword">new</span> Item(<span class="string">"ID:"</span>+i,<span class="string">"标题"</span>+ i);
            newsDataList.add(item);
        }
    }

}
</code></pre><ul>
<li><p>AndroidManifest.xml添加Activity信息</p>
  <activity android:name="com.example.blogapp.ItemDetail" android:label="@string/app_name"><br>  </activity></li>
<li>ItemDetail.java</li>
</ul>
<pre><code><span class="keyword">package</span> com.example.blogapp;
<span class="keyword">import</span> android.app.<span class="type">Activity</span>;
<span class="keyword">import</span> android.content.<span class="type">Intent</span>;
<span class="keyword">import</span> android.os.<span class="type">Bundle</span>;
<span class="keyword">import</span> android.view.<span class="type">View</span>;
<span class="keyword">import</span> android.view.<span class="type">View</span>.<span class="type">OnClickListener</span>;
<span class="keyword">import</span> android.widget.<span class="type">Button</span>;
public <span class="class"><span class="keyword">class</span> <span class="title">ItemDetail</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">Activity</span> {</span>
<span class="keyword">private</span> <span class="type">Button</span> btn ;
<span class="keyword">protected</span> void onCreate(<span class="type">Bundle</span> savedInstanceState) {
    <span class="keyword">super</span>.onCreate(savedInstanceState);
    setContentView(<span class="type">R</span>.layout.detail_main);
    btn = (<span class="type">Button</span>)<span class="keyword">this</span>.findViewById(<span class="type">R</span>.id.back);
    btn.setOnClickListener(<span class="keyword">new</span> <span class="type">OnClickListener</span>(){
        <span class="annotation">@Override</span>
        public void onClick(<span class="type">View</span> v) {
            <span class="type">Intent</span> it = <span class="keyword">new</span> <span class="type">Intent</span>(<span class="type">ItemDetail</span>.<span class="keyword">this</span>,<span class="type">MainActivity</span>.<span class="keyword">class</span>);
            <span class="type">ItemDetail</span>.<span class="keyword">this</span>.startActivity(it);
            <span class="type">ItemDetail</span>.<span class="keyword">this</span>.finish();
        }});
};
}
</code></pre><p>配置文件就是添加了2个按钮来获取点击事件跳转Activity。</p>
<h3 id="实现Activity通信，传递信息">实现Activity通信，传递信息</h3><ul>
<li>MainActivity.java修改onCreate方法如下:</li>
</ul>
<pre><code><span class="keyword">protected</span> <span class="function"><span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>{
        <span class="keyword">super</span>.onCreate(savedInstanceState);

        setContentView(R.layout.main);
        <span class="keyword">this</span>.initNewsData();
        myadapter = <span class="keyword">new</span>   
        MySimpleAdapter(MainActivity.<span class="keyword">this</span>,newsDataList,R.layout.data_list);  
        listView =(ListView) findViewById(R.id.listview);
        listView.setAdapter(myadapter);
        listView.setOnItemClickListener(<span class="keyword">new</span> OnItemClickListener(){
            <span class="annotation">@Override</span>
            <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onItemClick</span><span class="params">(AdapterView&lt;?&gt; adapter, View v, <span class="keyword">int</span> position,
                    <span class="keyword">long</span> id)</span> </span>{
                System.out.println(v);
                Item t = (Item)newsDataList.get(position);
                Intent it = <span class="keyword">new</span> Intent(MainActivity.<span class="keyword">this</span>,ItemDetail.class) ;
                it.putExtra(<span class="string">"blog_id"</span>, t.getId());
                MainActivity.<span class="keyword">this</span>.startActivity(it) ;
            }

        });

}
</code></pre><ul>
<li>ItemDetail.java修改onCreate方法如下:</li>
</ul>
<pre><code><span class="keyword">protected</span> <span class="function"><span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>{
    <span class="keyword">super</span>.onCreate(savedInstanceState);
    setContentView(R.layout.detail_main);
    Intent intent = getIntent();
    intent.getExtras();
    Bundle data = intent.getExtras();
    String id = data.getString(<span class="string">"blog_id"</span>);
    tv = (TextView) <span class="keyword">this</span>.findViewById(R.id.info);
    tv.setText(<span class="string">"接收到信息"</span>+id);
    btn = (Button)<span class="keyword">this</span>.findViewById(R.id.back);
    btn.setOnClickListener(<span class="keyword">new</span> OnClickListener(){

        <span class="annotation">@Override</span>
        <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>{
            Intent it = <span class="keyword">new</span> Intent(ItemDetail.<span class="keyword">this</span>,MainActivity.class);
            ItemDetail.<span class="keyword">this</span>.startActivity(it);
            ItemDetail.<span class="keyword">this</span>.finish();
        }});
}
</code></pre><ul>
<li>图示：</li>
</ul>
<p><img src="/images/android/android_blog_2_3.png" alt="Alt text"></p>
<ul>
<li>详情页：</li>
</ul>
<p><img src="/images/android/android_blog_2_4.png" alt="Alt text"></p>
<p>至此准备工作已经差不多了下面开始整合吧.</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/Android开发/">Android开发</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/04/19/android-blog-2/#comments" class="ds-thread-count comments-count-link" data-thread-key="2015/04/19/android-blog-2/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/04/19/android-blog-1/" title="Android应用开发一" itemprop="url">Android应用开发一</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Jackie wu" target="_blank" itemprop="author">Jackie wu</a>
		
  <p class="article-time">
    <time datetime="2015-04-19T06:35:46.000Z" itemprop="datePublished"> 发表于 2015-04-19</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>   学习Android已经有一段时间了，可是一直没有动手开发实际的应用，今天就简单的实践下使用android来抓取自己的博客在手机上查看。</p>
<h3 id="知识准备">知识准备</h3><ol>
<li>使用Jsoup抓取网页<br> Jsoup是一个很好用的java的库可以使用jsoup来抓取网页进行解析，jsoup提供了类似于jquery的元素查找的方法可以很方便解析HTML元素或者内容。详情请参考<a href="http://jsoup.org/" target="_blank" rel="external">jsoup</a>中内容进行参考。简单示例:</li>
</ol>
<pre><code>String blog_url = <span class="string">"http://blog.csdn.net/wujindou"</span>;
Document doc = Jsoup.connect(blog_url).
userAgent(<span class="string">"Mozilla"</span>).followRedirects(<span class="constant">true</span>).<span class="keyword">timeout</span>(<span class="number">10000</span>).<span class="keyword">get</span>();
Elements news = doc.select(<span class="string">"#article_list span.link_title a"</span>);
<span class="keyword">for</span>(Element link: news){
    String href = link.attr(<span class="string">"href"</span>);
    String <span class="property">id</span> = href.substring(href.<span class="property">length</span>()-<span class="number">8</span>,href.<span class="property">length</span>());
    System.out.println(<span class="property">id</span>);
    System.out.println(link.<span class="type">text</span>());
}
</code></pre><ol>
<li>编写自定义Adapter<br>使用ListView显示列表最简单的方法就是：定义item布局文件,然后使用Map建立组件之间的对应关系<br>比如:</li>
</ol>
<ul>
<li>定义各个item的布局文件data_list.xml<br><img src="/images/android/android_blog_1.png" alt="Alt text"></li>
<li>定义全局的布局文件main.xml<br><img src="/images/android/android_blog_2.jpg" alt="Alt text"></li>
<li>使用<br><img src="/images/android/android_blog_3.png" alt="Alt text"><br>这样写虽然可以但是结构不清晰而且如果数据的内容过多也不方便进行扩展了，所以考虑使用自定的Adapter来封装原始的SimpleAdapter类方便程序的扩展和实现。</li>
<li>首先编写Item类： </li>
</ul>
<pre><code><span class="keyword">public</span> <span class="keyword">class</span> Item {
    <span class="keyword">private</span> <span class="built_in">String</span> id;
    <span class="keyword">private</span> <span class="built_in">String</span> title;
    <span class="keyword">public</span> Item(<span class="built_in">String</span> id,<span class="built_in">String</span> title){
        <span class="keyword">this</span>.id = id ;
        <span class="keyword">this</span>.title = title;
    }
    <span class="keyword">public</span> <span class="built_in">String</span> getId() {
        <span class="keyword">return</span> id;
    }
    <span class="keyword">public</span> <span class="built_in">void</span> setId(<span class="built_in">String</span> id) {
        <span class="keyword">this</span>.id = id;
    }
    <span class="keyword">public</span> <span class="built_in">String</span> getTitle() {
        <span class="keyword">return</span> title;
    }
    <span class="keyword">public</span> <span class="built_in">void</span> setTitle(<span class="built_in">String</span> title) {
        <span class="keyword">this</span>.title = title;
    }
</code></pre><p>}</p>
<ul>
<li>自定义Adapter</li>
</ul>
<pre><code><span class="keyword">package</span> com.example.blogapp;
<span class="keyword">import</span> java.util.List;
<span class="keyword">import</span> android.content.Context;
<span class="keyword">import</span> android.view.LayoutInflater;
<span class="keyword">import</span> android.view.View;
<span class="keyword">import</span> android.view.ViewGroup;
<span class="keyword">import</span> android.widget.BaseAdapter;
<span class="keyword">import</span> android.widget.TextView;
<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MySimpleAdapter</span> <span class="keyword">extends</span> <span class="title">BaseAdapter</span></span>{
<span class="keyword">private</span> Context context;
<span class="comment">// 父列表视图容器</span>
<span class="keyword">private</span> LayoutInflater listContainer;
<span class="comment">// 新闻数据集合</span>
<span class="keyword">private</span> List&lt;Item&gt; newsDataList;
<span class="comment">// 列表项布局</span>
<span class="keyword">private</span> <span class="keyword">int</span> itemViewResource;
<span class="comment">// 列表项组件集合(title、author、count、date、flag)</span>
<span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ListItemView</span> </span>{ 
    <span class="keyword">public</span> TextView title;
    <span class="keyword">public</span> TextView id;
}

<span class="javadoc">/**
 * 根据父列表构造列表项适配器，加载列表项界面、读取并设置列表项数据
 *<span class="javadoctag"> @param</span> context 父列表
 *<span class="javadoctag"> @param</span> newsDataList 列表项数据
 *<span class="javadoctag"> @param</span> itemViewResource 列表项界面布局
 */</span>
<span class="function"><span class="keyword">public</span> <span class="title">MySimpleAdapter</span><span class="params">(Context context, List&lt;Item&gt; newsDataList, <span class="keyword">int</span> itemViewResource)</span> </span>{
    <span class="keyword">this</span>.context = context;
    <span class="keyword">this</span>.listContainer = LayoutInflater.from(context);
    <span class="keyword">this</span>.itemViewResource = itemViewResource;
    <span class="keyword">this</span>.newsDataList = newsDataList;
}

<span class="javadoc">/**
 * 根据数据条目返回列表项数目
 */</span>
<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>{
    <span class="keyword">return</span> newsDataList.size();
}

<span class="function"><span class="keyword">public</span> Object <span class="title">getItem</span><span class="params">(<span class="keyword">int</span> arg0)</span> </span>{
    <span class="keyword">return</span> <span class="keyword">null</span>;
}

<span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getItemId</span><span class="params">(<span class="keyword">int</span> arg0)</span> </span>{
    <span class="keyword">return</span> <span class="number">0</span>;
}

<span class="javadoc">/**
 * 根据位置和相关设定返回列表项
 *<span class="javadoctag"> @param</span> position 列表项起始位置
 *<span class="javadoctag"> @param</span> convertView 返回的每一个列表项
 *<span class="javadoctag"> @param</span> parent 列表项父容器
 */</span>

<span class="function"><span class="keyword">public</span> View <span class="title">getView</span><span class="params">(<span class="keyword">int</span> position, View convertView, ViewGroup parent)</span> </span>{

    <span class="comment">// 创建自定义列表项组件</span>
    ListItemView listItemView = <span class="keyword">null</span>;

    <span class="keyword">if</span> (convertView == <span class="keyword">null</span>) {

        <span class="comment">// 获取列表项布局（this.itemViewResource--）</span>
        convertView = listContainer.inflate(<span class="keyword">this</span>.itemViewResource, <span class="keyword">null</span>);
        <span class="comment">//初始化列表项各组件(title、author、count、date、flag)</span>
        listItemView = <span class="keyword">new</span> ListItemView();
        listItemView.title = (TextView) convertView
                .findViewById(R.id<span class="number">._</span>title);
        listItemView.id = (TextView) convertView
                .findViewById(R.id<span class="number">._</span>id);
        convertView.setTag(listItemView);

    } <span class="keyword">else</span> {
        listItemView = (ListItemView) convertView.getTag();
    }

    <span class="comment">//依次读取列表项数据中的第position项数据赋于news对象</span>
    Item news = newsDataList.get(position);
    listItemView.title.setText(news.getTitle());
    listItemView.id.setText(news.getId());
    <span class="keyword">return</span> convertView;
}
</code></pre><p>}</p>
<ul>
<li>data_list.xml</li>
</ul>
<pre><code>&lt;?xml <span class="variable">version=</span><span class="string">"1.0"</span> <span class="variable">encoding=</span><span class="string">"utf-8"</span>?&gt;
    &lt;TableLayout
        xmlns:<span class="variable">android=</span><span class="string">"http://schemas.android.com/apk/res/android"</span>
        android:<span class="variable">layout_width=</span><span class="string">"fill_parent"</span>
        android:<span class="variable">layout_height=</span><span class="string">"wrap_content"</span>&gt;
    &lt;TableRow&gt;
        &lt;TextView
            android:<span class="variable">id=</span><span class="string">"@+id/_id"</span>
            android:<span class="variable">textSize=</span><span class="string">"12px"</span>    
            android:<span class="variable">gravity=</span><span class="string">"center_vertical"</span>
            android:<span class="variable">layout_height=</span><span class="string">"wrap_content"</span>
            android:<span class="variable">layout_width=</span><span class="string">"wrap_content"</span>/&gt;
        &lt;TextView
            android:<span class="variable">id=</span><span class="string">"@+id/_title"</span>
            android:<span class="variable">textSize=</span><span class="string">"12px"</span>
            android:<span class="variable">gravity=</span><span class="string">"center_vertical"</span>
            android:<span class="variable">layout_height=</span><span class="string">"wrap_content"</span>
            android:<span class="variable">layout_width=</span><span class="string">"wrap_content"</span>/&gt;
    &lt;/TableRow&gt;
&lt;/TableLayout&gt;
</code></pre><ul>
<li>main.xml文件</li>
</ul>
<pre><code>&lt;LinearLayout xmlns:<span class="variable">android=</span><span class="string">"http://schemas.android.com/apk/res/android"</span>  
    xmlns:<span class="variable">tools=</span><span class="string">"http://schemas.android.com/tools"</span>
    android:<span class="variable">orientation=</span><span class="string">"vertical"</span>
    android:<span class="variable">layout_width=</span><span class="string">"fill_parent"</span>  
    android:<span class="variable">layout_height=</span><span class="string">"fill_parent"</span>  
    tools:<span class="variable">context=</span><span class="string">".MainActivity"</span> &gt;  
    &lt;TextView 
        android:<span class="variable">layout_width=</span><span class="string">"fill_parent"</span>
        android:<span class="variable">layout_height=</span><span class="string">"wrap_content"</span>
        android:<span class="variable">text=</span><span class="string">"@string/head"</span>
        /&gt;
    &lt;ListView  
        android:<span class="variable">id=</span><span class="string">"@+id/listview"</span>  
        android:<span class="variable">layout_width=</span><span class="string">"match_parent"</span>  
        android:<span class="variable">layout_height=</span><span class="string">"match_parent"</span> &gt;  
    &lt;/ListView&gt;  
&lt;/LinearLayout&gt;  
</code></pre><ul>
<li>使用MainActivity</li>
</ul>
<pre><code><span class="keyword">package</span> com.example.blogapp;

<span class="keyword">import</span> java.util.ArrayList;

<span class="keyword">import</span> java.util.List;

<span class="keyword">import</span> android.app.Activity;
<span class="keyword">import</span> android.os.Bundle;
<span class="keyword">import</span> android.view.Menu;
<span class="keyword">import</span> android.widget.ArrayAdapter;
<span class="keyword">import</span> android.widget.ListView;

<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>{

    <span class="keyword">private</span> Item item ;
    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;Item&gt; newsDataList = <span class="keyword">new</span> ArrayList&lt;Item&gt;();
    <span class="keyword">private</span> ListView listView ;
    <span class="keyword">private</span> MySimpleAdapter myadapter ;
    <span class="annotation">@Override</span>
    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>{
        <span class="keyword">super</span>.onCreate(savedInstanceState);

        setContentView(R.layout.main);
        <span class="keyword">this</span>.initNewsData();
        myadapter = <span class="keyword">new</span> MySimpleAdapter(MainActivity.<span class="keyword">this</span>, newsDataList,R.layout.data_list);  
      <span class="comment">//  listView.setAdapter(adapter);  </span>
        listView =(ListView) findViewById(R.id.listview);
        listView.setAdapter(myadapter);

    }

    <span class="annotation">@Override</span>
    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onCreateOptionsMenu</span><span class="params">(Menu menu)</span> </span>{
        <span class="comment">// Inflate the menu; this adds items to the action bar if it is present.</span>
        getMenuInflater().inflate(R.menu.main, menu);
        <span class="keyword">return</span> <span class="keyword">true</span>;
    }
    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initNewsData</span><span class="params">()</span> </span>{
        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">20</span>; i++) {
            item = <span class="keyword">new</span> Item(<span class="string">"ID:"</span>+i,<span class="string">"标题"</span>+ i);
            newsDataList.add(item);
        }
    }

}
</code></pre><p>效果：</p>
<p><img src="/images/android/android_blog_result.png" alt="Alt text"></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/Android开发/">Android开发</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/04/19/android-blog-1/#comments" class="ds-thread-count comments-count-link" data-thread-key="2015/04/19/android-blog-1/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/04/18/libevent-c-2/" title="Libevent整合protobuf （二）" itemprop="url">Libevent整合protobuf （二）</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Jackie wu" target="_blank" itemprop="author">Jackie wu</a>
		
  <p class="article-time">
    <time datetime="2015-04-18T02:01:47.000Z" itemprop="datePublished"> 发表于 2015-04-18</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>Protobuf已经下载好了，现在就开始封装一个简单的例子吧,参考官方的协议处理和封装以及编译成所需要的语言的<a href="https://developers.google.com/protocol-buffers/docs/cpptutorial?hl=zh-cn" target="_blank" rel="external">代码</a><br>定义一个简单的EchoMessage.proto<br>内容如下： </p>
<pre><code>message EchoRequest
{
    <span class="keyword">required</span> <span class="built_in">string</span> message = <span class="number">1</span>; <span class="comment">//请求字符串</span>
};
message EchoResponse
{
    <span class="keyword">required</span> <span class="built_in">string</span> response = <span class="number">1</span>; <span class="comment">//回应字符串</span>
};
</code></pre><p>测试：<br>test.cpp </p>
<pre><code><span class="preprocessor">#<span class="keyword">include</span>&lt;iostream&gt;</span>
<span class="preprocessor">#<span class="keyword">include</span>&lt;string&gt;</span>
<span class="preprocessor">#<span class="keyword">include</span> "echo.pb.h"</span>
<span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;
<span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span>
</span>{
    <span class="built_in">string</span> s=<span class="string">"hello request"</span>;
    EchoRequest request ;
    request.set_message(s);
    <span class="built_in">cout</span>&lt;&lt;request.message()&lt;&lt;endl;
    <span class="keyword">return</span> <span class="number">1</span>;
}
</code></pre><p>编译：<br> g++ echo.pb.cc testecho.cpp -o testecho -lprotobuf<br>问题：<br>./testecho: error while loading shared libraries: libprotobuf.so.8: cannot open shared object file: No such file or directory<br>export<br>LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/lib<br>最后：<br>client.cpp </p>
<pre><code>    <span class="preprocessor">#<span class="keyword">include</span>&lt;stdio.h&gt;</span>
<span class="preprocessor">#<span class="keyword">include</span>&lt;stdlib.h&gt;</span>
<span class="preprocessor">#<span class="keyword">include</span>&lt;string.h&gt;</span>
<span class="preprocessor">#<span class="keyword">include</span>&lt;unistd.h&gt;</span>
<span class="preprocessor">#<span class="keyword">include</span>&lt;iostream&gt;</span>
<span class="preprocessor">#<span class="keyword">include</span>&lt;sys/types.h&gt;</span>
<span class="preprocessor">#<span class="keyword">include</span>&lt;sys/socket.h&gt;</span>
<span class="preprocessor">#<span class="keyword">include</span>&lt;netinet/in.h&gt;</span>
<span class="preprocessor">#<span class="keyword">include</span> &lt;arpa/inet.h&gt;</span>
<span class="preprocessor">#<span class="keyword">include</span> "echo.pb.h"</span>

<span class="preprocessor">#<span class="keyword">define</span> oops(msg) {\
    perror(msg); \
    exit(1); \
}  </span>
<span class="preprocessor">#<span class="keyword">define</span> SIZE 256  </span>

<span class="preprocessor">#<span class="keyword">define</span> LISTEN_PORT 9999  </span>
<span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;

<span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv)</span>
</span>{


    <span class="keyword">int</span> socket_fd = socket(PF_INET, SOCK_STREAM, <span class="number">0</span>);
    <span class="keyword">if</span>(socket_fd == -<span class="number">1</span>)
        oops(<span class="string">"socket initiating error..."</span>);


    <span class="keyword">struct</span> sockaddr_in address;
    bzero(&amp;address, <span class="keyword">sizeof</span>(address));
    address.sin_family = AF_INET;
    address.sin_addr.s_addr = inet_addr(<span class="string">"127.0.0.1"</span>);
    address.sin_port =  htons(LISTEN_PORT);

    <span class="keyword">int</span> connect_result = connect(socket_fd, (<span class="keyword">struct</span> sockaddr*)&amp;address, <span class="keyword">sizeof</span>(address));
    <span class="keyword">if</span>(connect_result == -<span class="number">1</span>)
        oops(<span class="string">"connect error..."</span>);


         <span class="built_in">string</span> data;
         EchoRequest req;
         req.set_message(<span class="string">"wwwww"</span>);
         req.SerializeToString(&amp;data);
        <span class="keyword">char</span> bts[data.length()];
        <span class="built_in">strcpy</span>(bts, data.c_str());
        ssize_t write_length = write(socket_fd, bts, <span class="keyword">sizeof</span>(bts));
        <span class="keyword">if</span>(write_length &lt;= <span class="number">0</span> )
            oops(<span class="string">"error: write ..."</span>);


        <span class="keyword">char</span> buf[<span class="number">512</span>];
        bzero(buf, <span class="number">0</span>);
        ssize_t read_length = read(socket_fd, buf, <span class="keyword">sizeof</span>(buf));
        <span class="keyword">if</span>(read_length == -<span class="number">1</span>)
            oops(<span class="string">"error: read data from socket..."</span>);

        <span class="built_in">printf</span>(<span class="string">"the ret msg is: %s\n"</span>, buf);
    close(socket_fd);
    <span class="keyword">return</span> EXIT_SUCCESS;
}
</code></pre><p>最后介绍我看到过的一个架构吧：<br><img src="/images/c++/libevent.png" alt="Alt text"></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/c-学习/">c++学习</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/04/18/libevent-c-2/#comments" class="ds-thread-count comments-count-link" data-thread-key="2015/04/18/libevent-c-2/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>







  <nav id="page-nav" class="clearfix">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">Next<span></span></a>
  </nav>

</div>
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  

  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/大数据/" title="大数据">大数据<sup>12</sup></a></li>
			
		
			
				<li><a href="/tags/Android开发/" title="Android开发">Android开发<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/php/" title="php">php<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/c-学习/" title="c++学习">c++学习<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/git使用/" title="git使用">git使用<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Python/" title="Python">Python<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/python/" title="python">python<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/storm/" title="storm">storm<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/sklearn/" title="sklearn">sklearn<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/网络爬虫/" title="网络爬虫">网络爬虫<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/js学习笔记/" title="js学习笔记">js学习笔记<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/fitleupload/" title="fitleupload">fitleupload<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/js/" title="js">js<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Elasticsearch/" title="Elasticsearch">Elasticsearch<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/数据库/" title="数据库">数据库<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="http://wujindou.github.io" target="_blank" title="Jackie&#39;s Blog">Jackie&#39;s Blog</a>
            
          </li>
        
          <li>
            
            	<a href="http://blog.csdn.net/wujindou" target="_blank" title="CSDN(以前博客)">CSDN(以前博客)</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >

</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>




<script type="text/javascript">
  var duoshuoQuery = {short_name:"wujindou"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 







<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->





<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
 </html>
